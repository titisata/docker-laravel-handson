<div class="container">
    <h1>ホテル一覧</h1>
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card mt-3">
                <div class="card-header">ホテル編集</div>
                <div class="card-body">

                    <p>現在登録中のホテル</p>
                        <form action="/mypage/owner/hotel_insert" method="POST">
                            @csrf
                            <div class="d-flex">
                                <button type="submit" class="btn btn-sm btn-primary mx-2" name="update">追加</button>
                                <input type="hidden" name="id" value="">
                            </div>
                        
                        </form>
                    <div class="d-flex flex-column">
                    @foreach( $hotels as $hotel)
                        <div class='d-flex my-2'>
                            <form action="/mypage/owner/action_hotel_edit" method="POST">
                                @csrf
                                <div class="d-flex">
                                    <p class="mb-0">{{ $hotel->name }}</p>
                                    
                                    <button type="submit" class="btn btn-sm btn-primary mx-2" name="update">編集</button>
                                    <input type="hidden" name="id" value="">
                                </div>
                            
                            </form>
                            
                            <form action="" method="POST">
                                @csrf 
                                <button type="submit" class="btn btn-sm btn-danger mx-2 mb-0"  name="delete">削除</button>
                                <input type="hidden" name="id" value="">
                            </form>

                        
                        </div>
                    @endforeach 
                    
                    </div>
                </div>
            </div>
            
        </div>
    </div>
</div>

 HotelSelect::create([
            'hotel_group_id' => '1',
            'hotel_id' => '1',
        ]);
        HotelSelect::create([
            'hotel_group_id' => '1',
            'hotel_id' => '2',
        ]);
        HotelSelect::create([
            'hotel_group_id' => '2',
            'hotel_id' => '3',
        ]);
        HotelSelect::create([
            'hotel_group_id' => '2',
            'hotel_id' => '4',
        ]);

         \App\Models\ExperienceFolder::create([
            'partner_id' => 3,
            'name' => 'ゆっくりラフティング半日ツアー',
            'description' => 'ゆっくりラフティング半日ツアー！お得な料金で楽しもう♪テキストをサンプルで入れています。テキストをサンプルで入れています。テキストをサンプルで入れています。テキストをサンプルで入れています。テキストをサンプルで入れています。テキストをサンプルで入れています。テキストをサンプルで入れています。テキストをサンプルで入れています。テキストをサンプルで入れています。テキストをサンプルで入れています。',
            'address' => '千葉県木更津市北浜町１',
            'caution' => 'テスト的な注意事項です。テキストをサンプルで入れています。テキストをサンプルで入れています。テキストをサンプルで入れています。テキストをサンプルで入れています。',
            'detail' => 'テスト的な詳細情報です。テキストをサンプルで入れています。テキストをサンプルで入れています。テキストをサンプルで入れています。テキストをサンプルで入れています。',
            'category1' => '文化',
            'category2' => 'aa',
            'category3' => null,
            'is_lodging' => true,
            'start_date' => (new DateTime(date('Y-m-d')))->modify('-100day'),
            'end_date' => (new DateTime(date('Y-m-d')))->modify('+50day'),
            'is_before_lodging' => false,
            'price_child' => 5000,
            'price_adult' => 7000,
            'recommend_flag' => 1,
            'recommend_sort_no' => 4,
        ]);

        \App\Models\Experience::create([
            'experience_folder_id' => 10,
            'name' => '19:00からの部',
            'start_date' =>  date('Y-m-d'),
            'end_date' =>  date('Y-m-d'),
            'sort_no' => 1,
            'quantity' => 5,
            'price_child' => 3000,
            'price_adult' => 2000,
        ]);

        @forelse($hotel_groups as $hotel_group)
                        @if(in_array($hotel_group->id, $checked_hotels_group, true))
                            <div>
                                <input type="checkbox" id="{{ $hotel_group->name }}" name="hotel_group[]" value="{{ $hotel_group->id }}" checked >
                                <label for="{{ $hotel_group->name }}">{{ $hotel_group->name }}</label>
                            </div> 
                        @else
                            <div>
                                <input type="checkbox" id="{{ $hotel_group->name }}" name="hotel_group[]" value="{{ $hotel_group->id }}">
                                <label for="{{ $hotel_group->name }}">{{ $hotel_group->name }}</label>
                            </div> 
                        @endif
                    @empty
                        <p>グループがありません</p>
                    @endforelse


                    <p class="mb-4 text-start"><a role="button" href="/partner/{{ $experienceFolder->partner->id }}" class="btn btn-outline-secondary rounded-pill">会社情報</a></p>
                    <p class="mb-4 text-start"><a role="button" href="/partner/{{ $experienceFolder->partner->id }}" class="btn btn-outline-secondary rounded-pill">会社情報</a></p>


                    <input class="form-check-input" type="radio" id="hotel_group_{{ $hotelGroup->id }}" name="hotel_group_id" value="{{ $hotelGroup->id }}" onchange="radiohotelSwitch()">
                                    <label class="form-check-label" for="hotel_group_{{ $hotelGroup->id }}">
                                        {{ $hotelGroup->name }} : 
                                        大人<span class="small small_font ms-1">税込</span><span id='hotel_adult_price_{{ $hotelGroup->id }}' value="{{ $hotelGroup->price_adult }}" class="fw-bold">{{ number_format($hotelGroup->price_adult) }}</span><span class="small small_font">円 / 人</span>　
                                        子ども<span class="small small_font ms-1">税込</span><span id='hotel_child_price_{{ $hotelGroup->id }}' value="{{ $hotelGroup->price_child }}" class="fw-bold">{{ number_format($hotelGroup->price_child) }}</span><span class="small small_font">円 / 人</span>
                                    </label>

                                    <input class="form-check-input" type="radio" id="food_group_{{ $foodGroup->id }}" name="food_group_id" value="{{ $foodGroup->id }}" onchange="radiofoodSwitch()">
                                    <label class="form-check-label" for="food_group_{{ $foodGroup->id }}">
                                        {{ $foodGroup->name }} :  
                                        大人<span class="small small_font ms-1">税込</span><span id='food_adult_price_{{ $foodGroup->id }}' value='{{ $foodGroup->price_adult }}' class="fw-bold">{{ number_format($foodGroup->price_adult) }}</span><span class="small small_font">円 / 人</span>　
                                        子ども<span class="small small_font ms-1">税込</span><span id='food_child_price_{{ $foodGroup->id }}' class="fw-bold" value='{{ $foodGroup->price_child }}'>{{ number_format($foodGroup->price_child) }}</span><span class="small small_font">円 / 人</span>
                                    </label>

                                    @if(!$experienceFolder->foodGroup->isEmpty())
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" id="food_group_0" name="food_group_id" value="0" onchange="radiofoodSwitch()">
                                    <label class="form-check-label" for="food_group_null">食事なし</label>
                                </div>
                            @endempty




                             @if(in_array($hotel_group->id, $checked_hotels_group, true))
                                        <div>
                                            <input type="checkbox" id="{{ $hotel_group->name }}" name="hotel_group[]" value="{{ $hotel_group->id }}" checked >
                                            <label for="{{ $hotel_group->name }}">{{ $hotel_group->name }}</label>
                                        </div> 
                                    @else
                                        <div>
                                            <input type="checkbox" id="{{ $hotel_group->name }}" name="hotel_group[]" value="{{ $hotel_group->id }}">
                                            <label for="{{ $hotel_group->name }}">{{ $hotel_group->name }}</label>
                                        </div> 
                                    @endif




                                    @if(in_array($food_group->id, $checked_foods_group, true))
                                    <div>
                                        <input type="checkbox" id="{{ $food_group->name }}" name="food_group[]" value="{{ $food_group->id }}" checked >
                                        <label for="{{ $food_group->name }}">{{ $food_group->name }}</label>
                                    </div> 
                                    @else
                                    <div>
                                        <input type="checkbox" id="{{ $food_group->name }}" name="food_group[]" value="{{ $food_group->id }}">
                                        <label for="{{ $food_group->name }}">{{ $food_group->name }}</label>
                                    </div> 
                                    @endif

                           前泊・後泊
                                    <div class="bg-f-part p-2 rounded-2 d-lg-none">
                                <p class="text-white fs-5">体験日: {{ app('request')->input('keyword') }}</p>
                                <p class="text-white mb-0 fs-5">{{ $experienceFolder->is_lodging ? ('宿泊日: ' . ($experienceFolder->is_before_lodging ?  (new DateTime(app('request')->input('keyword')))->modify("-1day")->format('Y-m-d') :  app('request')->input('keyword') ) ) : '宿泊なし' }}</p>
                            </div>

                              <form name="favorite_form" action="/favorite_edit" method="POST" target="sendFavorite">
                        @csrf
                        <input type="hidden" name="f_user_id" value="{{ $user->id }}">
                        <input type="hidden" name="f_experienceFolder_id" value="{{ $experienceFolder->id }}">
                        <input type="hidden" name="f_table_name" value="experience_folders">
                    </form>

                    <input type="hidden" id="user_id" value="{{ $user->id }}">

                    <div class="d-flex align-items-center" >
                        <h3 class="fw-bold py-auto text-gray" style="--bs-bg-opacity: .10;" >{{ $experienceFolder->name }}</h3>
                        
                        <div class="ms-3" >
                            @if($experienceFolder->favorite() != '')
                                <i id="favorite" class="bi bi-heart-fill pink fs-3" onclick="submit_favorite();"></i>
                            @else
                                <i id="not_favorite" class="bi bi-heart-fill text-gray fs-3" onclick="submit_not_favorite();"></i>
                            @endif
                        </div>
                        
                    </div>

           


        <h2 class="mt-5 mb-4 ms-3 ms-md-0 fw-bold">おすすめの食べ物</h2>

            <ul class="horizontal-list">
                @foreach ($food_goods_folders as $goods_item_folder)
                    @include('components.goods_small_cell', ['goods_folder'=>$goods_item_folder])
                @endforeach
            </ul>


            <h2  class="mt-5 mb-4 ms-3 ms-md-0 fw-bold">おすすめの飲み物</h2>

            <ul class="horizontal-list">
                @foreach ($drink_goods_folders as $goods_item_folder)
                    @include('components.goods_small_cell', ['goods_folder'=>$goods_item_folder])
                @endforeach
            </ul>


            <h2  class="mt-5 mb-4 ms-3 ms-md-0 fw-bold">おすすめの雑貨</h2>

            <ul class="horizontal-list">
                @foreach ($goods_goods_folders as $goods_item_folder)
                    @include('components.goods_small_cell', ['goods_folder'=>$goods_item_folder])
                @endforeach
            </ul>


            <!-- <div class="mt-5">
                <a href="/search/experience">体験検索へ</a>
            </div> -->

            @foreach ($goods_folders as $goods_folder)

                <p>{{ $goods_folder->id }}</p>

            @endforeach


            <h2  class="mt-5 mb-4 ms-3 ms-md-0 fw-bold">おすすめの飲み物</h2>

            <ul class="horizontal-list">
                @foreach ($drink_goods_folders as $goods_item_folder)
                    @include('components.goods_small_cell', ['goods_folder'=>$goods_item_folder])
                @endforeach
            </ul>


            <h2  class="mt-5 mb-4 ms-3 ms-md-0 fw-bold">おすすめの雑貨</h2>

            <ul class="horizontal-list">
                @foreach ($goods_goods_folders as $goods_item_folder)
                    @include('components.goods_small_cell', ['goods_folder'=>$goods_item_folder])
                @endforeach
            </ul>3

             @foreach ($goods_folders as $goods_folder)
                @foreach($goods_folder as $one_goods)
                    <p>{{ $one_goods->category1 }}</p>
                @endforeach
            @endforeach


            <ul class="horizontal-list">
                    @foreach ($food_goods_folders as $goods_item_folder)
                        @include('components.goods_small_cell', ['goods_folder'=>$goods_item_folder])
                    @endforeach
                </ul>




                @if (!$experienceFolder->is_holiday(app('request')->input('keyword')))
                        @include('components.experience_cell', ['experienceFolder'=>$experienceFolder])
                    @endif



                    <h5 class="text-white mb-0 ms-lg-4">
                        {{ $experienceFolder->is_lodging ? ('宿泊日: ' . ($experienceFolder->is_before_lodging ?  (new DateTime(' (前泊)'.app('request')->input('keyword')))->modify("-1day")->format('Y-m-d') : ' (後泊) ' . app('request')->input('keyword') ) ) : '宿泊なし' }}
                    </h5>

@extends('mypage.layouts.app')

@section('menu', 'owner_reserve')
@section('content')
<div class="container">
    <h1>予約状況</h1>
    
        
    @forelse ($partners as $partner)
    
    @forelse ($partner->experiences as $experiences_folder)
    <div class="card mt-3">
        <div class="card-header">{{ $experiences_folder->name }}への予約</div>
        <div class="row justify-content-center">
            <div class="col-md-8">
                
                <div class="card mt-3">
                    <div class="card-header d-flex align-items-center">
                        <h3 class="mb-0">{{ $partner->name }}様の予約状況</h3>
                        <!-- <a href="/mypage/owner/reserve_make/{id}" style="text-decoration: none; color: inherit;">
                            <button class="btn btn-sm btn-success ms-5">新規登録</button>
                        </a> -->
                    </div>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">ユーザー名</th>
                                <th scope="col">予約日</th>
                                <th scope="col">人数</th>
                                <th scope="col">宿泊</th>
                                <th scope="col">食事</th>
                                <th scope="col">連絡事項</th>
                                <th scope="col">ステータス</th>
                                <th scope="col">選定ホテル</th>
                                
                            </tr>
                        </thead>
                        @forelse ($experiences_folder->reserves as $reserved_experience)
                            <tr class="align-items-center">
                                <th scope="row"></th>
                                <td>
                                    <a href="/mypage/owner/reserve_edit/{{ $reserved_experience->id }}">
                                        <p>名前: {{ $reserved_experience->user->name }}様</p>
                                    </a> 
                                </td>
                                <td>
                                    <p>予約日: {{ $reserved_experience->experience->start_date }}</p>
                                </td>  
                                <td>
                                    <p>大人: {{ $reserved_experience->quantity_adult }}人 子ども: {{ $reserved_experience->quantity_child }}人</p>
                                </td>
                                <td>
                                    <p>宿泊: {{ $reserved_experience->hotelGroup?->name ?? 'なし' }}</p>
                                </td>
                                <td>
                                    <p>食事: {{ $reserved_experience->foodGroup?->name ?? 'なし' }}</p>
                                </td>
                                <td>
                                    <p>連絡事項: {{ $reserved_experience->message }}</p>
                                </td>
                                <td>
                                    <p>ステータス: {{ $reserved_experience->status }}</p>
                                </td>
                                <td>
                                    <p>選定ホテル: {{ $reserved_experience->hotel->name ?? '未確定'}}</p>
                                </td>
                            </tr>   
                        @empty
                        <p>予約はありません</p>
                        @endforelse
                    </table>
                        
                                
                    </div>
                @empty
                    <p>体験がありません</p>
                @endforelse
                    </div>
                </div>
            </div>
        </div>
    @empty
        <p>パートナーがいません</p>
    @endforelse
        
    
</div>
@endsection



<div>  
                            <table class="table table-hover">
                                @forelse ($experiences_folder->reserves as $reserved_experience)
                                    @if ($loop->first)
                                    <thead>
                                        <tr>
                                            <th scope="col">ユーザー名</th>
                                            <th scope="col">予約日</th>
                                            <th scope="col">人数</th>
                                            <th scope="col">宿泊</th>
                                            <th scope="col">食事</th>
                                            <th scope="col">連絡事項</th>
                                            <th scope="col">ステータス</th>
                                            <th scope="col">選定ホテル</th>
                                        </tr>
                                    </thead>
                                    @endif
                                    <tr class="align-items-center">
                                        <th scope="row">
                                        <a href="/mypage/owner/reserve_edit/{{ $reserved_experience->id }}">
                                            {{ $reserved_experience->user->name }}様</th>
                                        </a> 
                                        <td>
                                            {{ $reserved_experience->start_date }}
                                        </td>
                                        <td>
                                                大人: {{ $reserved_experience->quantity_adult }}人 子ども: {{ $reserved_experience->quantity_child }}人
                                        </td>  
                                        <td>
                                            {{ $reserved_experience->hotelGroup?->name ?? 'なし' }}
                                        </td>
                                        <td>
                                            {{ $reserved_experience->foodGroup?->name ?? 'なし' }}
                                        </td>
                                        <td>
                                            {{ $reserved_experience->message }}
                                        </td>
                                        <td>
                                            
                                            @if( $reserved_experience->status == '対応待ち')
                                            <p class="bg-danger text-white mb-0 text-center">{{ $reserved_experience->status }}</p>
                                            @else
                                            <p class="bg-primary text-white mb-0 text-center">{{ $reserved_experience->status }}</p>
                                            @endif
                                        </td>
                                        <td>  
                                            {{ $reserved_experience->hotel->name ?? '未確定'}}
                                        </td>
                                    </tr>   
                                    
                                @empty
                                    <p>予約がありません</p>
                                @endforelse
                                </table>
                            </div>


                            <th scope="row">
            <a href="/mypage/owner/reserve_edit/{{ $reserved_experience->id }}">
                {{ $reserved_experience->user->name }}様</th>
            </a> 
            <td>
                {{ $reserved_experience->start_date }}
            </td>
            <td>
                    大人: {{ $reserved_experience->quantity_adult }}人 子ども: {{ $reserved_experience->quantity_child }}人
            </td>  
            <td>
                {{ $reserved_experience->hotelGroup?->name ?? 'なし' }}
            </td>
            <td>
                {{ $reserved_experience->foodGroup?->name ?? 'なし' }}
            </td>
            <td>
                {{ $reserved_experience->message }}
            </td>
            <td>
                
                @if( $reserved_experience->status == '対応待ち')
                <p class="bg-danger text-white mb-0 text-center">{{ $reserved_experience->status }}</p>
                @else
                <p class="bg-primary text-white mb-0 text-center">{{ $reserved_experience->status }}</p>
                @endif
            </td>
            <td>  
                {{ $reserved_experience->hotel->name ?? '未確定'}}
            </td>


            // public function event()
    // {
    //     $user = Auth::user();
    //     $experiences_folders = ExperienceFolder::all();
    //     return view('mypage.owner.event', compact('user', 'experiences_folders'));
    // }

    // public function event_add(string $id)
    // {
    //     $user = Auth::user();
    //     $experiences_folder = ExperienceFolder::find($id);
    //     $categories = ExperienceCategory::all();

    //     $hotel_groups = HotelGroup::all();
        
    //     $food_groups = FoodGroup::all();

    //     return view('mypage.owner.event_add', compact('user', 'experiences_folder', 'categories', 'hotel_groups', 'food_groups'));
    // }

    // public function action_event_add(EventAddRequest $request)
    // {

    //     $user_id = $request->user_id;
    //     $name = $request->name;
    //     $price_adult = $request->price_adult;
    //     $price_child = $request->price_child;
    //     $address = $request->address;
    //     $phone = $request->phone;
    //     $description = $request->description;
    //     $detail = $request->detail;
    //     $caution = $request->caution;
    //     $category = $request->category;
    //     $is_lodging = $request->is_lodging;
    //     $is_before_lodging = $request->is_before_lodging;
    //     $recommend_flag = $request->recommend_flag;
    //     $status = $request->status;
    //     $table_name = $request->table_name;
    //     $hotel_groups = $request->hotel_group;
    //     $food_groups = $request->food_group;
    //     $ex_name = $request->ex_name;
    //     $ex_price_adult = $request->ex_price_adult;
    //     $ex_price_child = $request->ex_price_child;
    //     $ex_sort_no = $request->ex_sort_no;
    //     $ex_quantity = $request->ex_quantity;
    //     $ex_status = $request->ex_status;  
    //     $key_count = $request->key_count;

    //     $data = ExperienceFolder::create([
    //         'user_id' => $user_id,
    //         'name' => $name,
    //         'price_adult' => $price_adult,
    //         'price_child' => $price_child,
    //         'address' => $address,
    //         'phone' => $phone,
    //         'description' => $description,
    //         'detail' => $detail,
    //         'caution' => $caution,
    //         'is_lodging' => $is_lodging,
    //         'is_before_lodging' => $is_before_lodging,
    //         'status' => $status,
    //         'recommend_flag' => $recommend_flag,
    //         'category1' => $category,
    //     ]);   

    //     if( $request->file('image_path') != ''){
    //     $img = $request->file('image_path');
    //     $path = $img->store('images','public');

    //     Image::create([
    //         'table_name' => $table_name,
    //         'table_id' => $data->id,
    //         'image_path' => '/storage/' . $path,
    //     ]);
    // }

    // if($is_lodging == 1){
    //     for ($i=0; $i < count($hotel_groups); $i++) {

    //         $hotel_group = $hotel_groups[$i];
            
    //         //選択されたものをインサート

    //         HotelGroupSelect::create([
    //             'experience_folder_id' => $data->id,
    //             'hotel_group_id' => $hotel_group,
    //         ]);

    //     }
    // }

    // if( $is_lodging == 1){
    //     for ($i=0; $i < count($food_groups); $i++) {

    //         $food_group = $food_groups[$i];
            
    //         //選択されたものをインサート

    //             FoodGroupSelect::create([
    //                 'experience_folder_id' => $data->id,
    //                 'food_group_id' => $food_group,
    //             ]);

    //     }
    // }

    // Experience::create([
    //     'experience_folder_id' => $data->id,
    //     'name' => $ex_name,
    //     'price_adult' => $ex_price_adult,
    //     'price_child' => $ex_price_child,
    //     'sort_no' => $ex_sort_no,
    //     'quantity' => $ex_quantity,
    //     'status' => $ex_status,
    // ]);

    // for ($i=1; $i < $key_count + 1; $i++) {
    //     $ex_names = $request['ex_names_'.$i];
    //     $ex_ids = $request['ex_ids_'.$i];
    //     $ex_sort_nos = $request['ex_sort_nos_'.$i];
    //     $ex_quantities = $request['ex_quantities_'.$i];
    //     $ex_price_adults = $request['ex_price_adults_'.$i];
    //     $ex_price_childs = $request['ex_price_childs_'.$i];
    //     $ex_statuses = $request['ex_statuses_'.$i];
    //     $name = $ex_names;
    //     $price_adult = $ex_price_adults;
    //     $price_child = $ex_price_childs;
    //     $sort_no = $ex_sort_nos;
    //     $quantity = $ex_quantities;
    //     $status = $ex_statuses;

    //     Experience::create([
    //         'experience_folder_id' => $data->id,
    //         'name' => $name,
    //         'price_adult' => $price_adult,
    //         'price_child' => $price_child,
    //         'sort_no' => $sort_no,
    //         'quantity' => $quantity,
    //         'status' => $status,
    //     ]);

    // }

    // $return_view = $this->event();
    // return $return_view;
        
    // }

    // public function event_edit(string $id)
    // {
    //     $experiences_folder = ExperienceFolder::find($id);
    //     $categories = ExperienceCategory::all();
        
    //     $hotel_groups = HotelGroup::all();
    //     $hotel_select_ids = HotelGroupSelect::where('experience_folder_id',$id)->get();
    //     $checked_hotels_group = array();
    //     foreach($hotel_select_ids as $hotel_select_id){
    //         $checked_hotels_group[] = $hotel_select_id->hotel_group_id;
    //     }
        
    //     $food_groups = FoodGroup::all();
    //     $food_select_ids = FoodGroupSelect::where('experience_folder_id',$id)->get();
    //     $checked_foods_group = array();
    //     foreach($food_select_ids as $food_select_id){
    //         $checked_foods_group[] = $food_select_id->food_group_id;
    //     }
    //     return view('mypage.owner.event_edit', compact('experiences_folder', 'categories', 'hotel_groups', 'food_groups', 'checked_foods_group', 'checked_hotels_group'));
    // }

    // public function event_edit_update(EventEditRequest $request)
    // {

    //     $user_id = $request->user_id;
    //     $name = $request->name;
    //     $price_adult = $request->price_adult;
    //     $price_child = $request->price_child;
    //     $address = $request->address;
    //     $phone = $request->phone;
    //     $description = $request->description;
    //     $detail = $request->detail;
    //     $caution = $request->caution;
    //     $category = $request->category;
    //     $is_lodging = $request->is_lodging;
    //     $is_before_lodging = $request->is_before_lodging;
    //     $recommend_flag = $request->recommend_flag;
    //     $status = $request->status; 
    //     $id = $request->id;
    //     $key = $request->key;
    //     $hotel_groups = $request->hotel_group;
    //     $food_groups = $request->food_group;
    //     $hotel_result = $request->hotel_result;
    //     $hotel_result = $request->hotel_result;

    //     $experiences_folder = ExperienceFolder::where('id', $id)->update([
    //         'user_id' => $user_id,
    //         'name' => $name,
    //         'price_adult' => $price_adult,
    //         'price_child' => $price_child,
    //         'address' => $address,
    //         'phone' => $phone,
    //         'description' => $description,
    //         'detail' => $detail,
    //         'caution' => $caution,
    //         'is_lodging' => $is_lodging,
    //         'is_before_lodging' => $is_before_lodging,
    //         'status' => $status,
    //         'recommend_flag' => $recommend_flag,
    //         'category1' => $category,
    //     ]);

    //     //前回までの情報を削除
    //     $hotel_delete = HotelGroupSelect::where('experience_folder_id', $id)->delete();

    //     if($is_lodging == 1){
    //         for ($i=0; $i < count($hotel_groups); $i++) {

    //             $hotel_group = $hotel_groups[$i];
                
    //             //その後、選択されたものをインサート
    
    //             HotelGroupSelect::create([
    //                 'experience_folder_id' => $id,
    //                 'hotel_group_id' => $hotel_group,
    //             ]);
    
    //         }
    //     }
        
        

    //     //前回までの情報を削除
    //     $food_delete = FoodGroupSelect::where('experience_folder_id', $id)->delete();

    //     if( $is_lodging == 1){
    //         for ($i=0; $i < count($food_groups); $i++) {

    //             $food_group = $food_groups[$i];
                
    //             //その後、選択されたものをインサート

    //                 FoodGroupSelect::create([
    //                     'experience_folder_id' => $id,
    //                     'food_group_id' => $food_group,
    //                 ]);

    //         }
    //     }

    //     for ($i=1; $i < $key + 1; $i++) {
    //         $ex_names = $request['ex_names_'.$i];
    //         $ex_ids = $request['ex_ids_'.$i];
    //         $ex_sort_nos = $request['ex_sort_nos_'.$i];
    //         $ex_quantities = $request['ex_quantities_'.$i];
    //         $ex_price_adults = $request['ex_price_adults_'.$i];
    //         $ex_price_childs = $request['ex_price_childs_'.$i];
    //         $ex_statuses = $request['ex_statuses_'.$i];
    //         $ex_id = $ex_ids;
    //         $ex_name = $ex_names;
    //         $ex_price_adult = $ex_price_adults;
    //         $ex_price_child = $ex_price_childs;
    //         $ex_sort_no = $ex_sort_nos;
    //         $ex_quantity = $ex_quantities;
    //         $ex_status = $ex_statuses;


    //         if( $ex_id == ''){

    //             Experience::create([
    //                 'experience_folder_id' => $id,
    //                 'name' => $ex_name,
    //                 'price_adult' => $ex_price_adult,
    //                 'price_child' => $ex_price_child,
    //                 'sort_no' => $ex_sort_no,
    //                 'quantity' => $ex_quantity,
    //                 'status' => $ex_status,
    //             ]);

    //         }else{

    //             Experience::where('id', $ex_id)->update([
    //                 'experience_folder_id' => $id,
    //                 'name' => $ex_name,
    //                 'price_adult' => $ex_price_adult,
    //                 'price_child' => $ex_price_child,
    //                 'sort_no' => $ex_sort_no,
    //                 'quantity' => $ex_quantity,
    //                 'status' => $ex_status,
    //             ]);
    //         }
           
    //     }

    //     $return_view = $this->event();
    //     return $return_view;
        
    // }

    // public function event_edit_delete(Request $request){

    //     $id = $request->id;
    //     $delete_id = $request->delete_id;

    //     $experience_delete = Experience::where('id', $delete_id)->delete();

    //     $return_view = $this->event_edit($id);
    //     return $return_view;
        
    // }

    // public function action_event_delete(Request $request)
    // {
    //     //idをもとにexperiencecategory.tableから削除

    //     $id = $request->id;

    //     $hotel_delete = HotelGroupSelect::where('experience_folder_id', $id)->delete();

    //     $food_delete = FoodGroupSelect::where('experience_folder_id', $id)->delete();

    //     $experience_delete = Experience::where('experience_folder_id', $id)->delete();

    //     $experience_folder = ExperienceFolder::where('id', $id)->delete();

    //     $return_view = $this->event();
    //     return $return_view;

    // }

    // public function experience_delete(string $id)
    // {
    //     //experience_deleteページへ
    //     $experience = Experience::where('id', $id)->first();
    //     return view('mypage.owner.experience_delete', compact('experience'));
    // }

    // public function action_experience_delete(Request $request)
    // {
    //     $id = $request->ex_ids;
    //     $experience_folder_id = $request->ex_folder_ids;

    //     //idをもとにexperience.tableから削除
    //     $experience = Experience::where('id', $id)->delete();

    //     $return_view = $this->event_edit($experience_folder_id);
    //     return $return_view;
    // }

    // public function goods()
    // {
    //     $user = Auth::user();
    //     $partner = Partner::where('user_id', $user->id)->first();
    //     $goods_folders = GoodsFolder::all();
    //     return view('mypage.owner.goods', compact('user', 'goods_folders'));
    // }


    // public function goods_add(string $id)
    // {
    //     $user = Auth::user();
    //     $goods_folder = GoodsFolder::find($id);
    //     $categories = GoodsCategory::all();
    //     return view('mypage.owner.goods_add', compact('user', 'goods_folder', 'categories'));
    // }

    // public function action_goods_add(GoodsAddRequest $request)
    // {
    //     $user_id = $request->user_id;
    //     $name = $request->name;
    //     $price = $request->price;
    //     $description = $request->description;
    //     $detail = $request->detail;
    //     $caution = $request->caution;
    //     $category = $request->category;
    //     $recommend_flag = $request->recommend_flag;
    //     $goods_name = $request->goods_name;
    //     $goods_price = $request->goods_price;
    //     $goods_description = $request->goods_description;
    //     $goods_sort_no = $request->goods_sort_no;
    //     $goods_quantity = $request->goods_quantity;
    //     $goods_status = $request->goods_status;
    //     $table_name = $request->table_name;
    //     $key_count = $request->key_count;

    //     $data = GoodsFolder::create([
    //         'user_id' => $user_id,
    //         'name' => $name,
    //         'price' => $price,
    //         'description' => $description,
    //         'detail' => $detail,
    //         'caution' => $caution,
    //         'recommend_flag' => $recommend_flag,
    //         'category1' => $category,
    //     ]);     

    //     Goods::create([
    //         'goods_folder_id' => $data->id,
    //         'name' => $goods_name,
    //         'price' => $goods_price,
    //         'description' => $goods_description,
    //         'sort_no' => $goods_sort_no,
    //         'quantity' => $goods_quantity,
    //         'status' => $goods_status,
    //     ]);


    //     if( $request->file('image_path') != ''){
    //         $img = $request->file('image_path');
    //         $path = $img->store('images','public');

    //         Image::create([
    //             'table_name' => $table_name,
    //             'table_id' => $data->id,
    //             'image_path' => '/storage/' . $path,
    //         ]);

    //     }
        

    //     for ($i=1; $i < $key_count + 1; $i++) {
    //         $goods_names = $request['goods_names_'.$i];
    //         $goods_pricies = $request['goods_pricies_'.$i];
    //         $goods_descriptions = $request['goods_descriptions_'.$i];
    //         $goods_sort_nos = $request['goods_sort_nos_'.$i];
    //         $goods_quantities = $request['goods_quantities_'.$i];
    //         $goods_statuses = $request['goods_statuses_'.$i];
    //         $name = $goods_names;
    //         $price = $goods_pricies;
    //         $description = $goods_descriptions;
    //         $sort_no = $goods_sort_nos;
    //         $quantity = $goods_quantities;
    //         $status = $goods_statuses;

    //         Goods::create([
    //             'goods_folder_id' => $data->id,
    //             'name' => $name,
    //             'price' => $price,
    //             'description' => $description,
    //             'sort_no' => $sort_no,
    //             'quantity' => $quantity,
    //             'status' => $status,
    //         ]);
   
    //     }

    //     $return_view = $this->goods();
    //     return $return_view;
        
    // }


    // public function goods_edit(string $id)
    // {
    //     $goods_folder = GoodsFolder::find($id);
    //     $categories = GoodsCategory::all();
    //     return view('mypage.owner.goods_edit', compact('goods_folder', 'categories'));
    // }

    // public function goods_edit_update(GoodsEditRequest $request)
    // {

    //     $id = $request->id;
    //     $user_id = $request->user_id;
    //     $name = $request->name;
    //     $price = $request->price;
    //     $description = $request->description;
    //     $detail = $request->detail;
    //     $caution = $request->caution;
    //     $category = $request->category;
    //     $recommend_flag = $request->recommend_flag;
    //     $status = $request->status;
    //     $category1 = $request->category1;
    //     $key = $request->key;

    //     $goods_folder = GoodsFolder::where('id', $id)->update([
    //         'name' => $name,
    //         'user_id' => $user_id,
    //         'price' => $price,
    //         'description' => $description,
    //         'caution' => $caution,
    //         'detail' => $detail,
    //         'category1' => $category1,
    //         'status' => $status,
    //         'recommend_flag' => $recommend_flag,
    //     ]);

    //     for ($i=1; $i < $key + 1; $i++) {
    //         $goods_ids = $request['goods_ids_'.$i];
    //         $goods_names = $request['goods_names_'.$i];
    //         $goods_pricies = $request['goods_pricies_'.$i];
    //         $goods_descriptions = $request['goods_descriptions_'.$i];
    //         $goods_sort_nos = $request['goods_sort_nos_'.$i];
    //         $goods_quantities = $request['goods_quantities_'.$i];
    //         $goods_statuses = $request['goods_statuses_'.$i];
    //         $goods_id = $goods_ids;
    //         $goods_name = $goods_names;
    //         $goods_price = $goods_pricies;
    //         $goods_description = $goods_descriptions;
    //         $goods_sort_no = $goods_sort_nos;
    //         $goods_quantity = $goods_quantities;
    //         $goods_status = $goods_statuses;

    //         if( $goods_id == ''){
    //             Goods::create([
    //                 'goods_folder_id' => $id,
    //                 'name' => $goods_name,
    //                 'price' => $goods_price,
    //                 'description' => $goods_description,
    //                 'sort_no' => $goods_sort_no,
    //                 'quantity' => $goods_quantity,
    //                 'status' => $goods_status,
    //             ]);
    //         }else{
    //             Goods::where('id', $goods_id)->update([
    //                 'goods_folder_id' => $id,
    //                 'name' => $goods_name,
    //                 'price' => $goods_price,
    //                 'description' => $goods_description,
    //                 'quantity' => $goods_quantity,
    //                 'status' => $goods_status,
    //             ]);
    //         }
    //     }

        
    //     $return_view = $this->goods();
    //     return $return_view;
    // }

    // public function goods_edit_delete(Request $request){

    //     $id = $request->id;
    //     $delete_id = $request->delete_id;

    //     $goods_delete = Goods::where('id', $delete_id)->delete();

    //     $return_view = $this->goods_edit($id);
    //     return $return_view;
        
    // }


    // public function goods_delete(string $id)
    // {
    //     //goods_deleteページへ
    //     $goods = Goods::where('id', $id)->first();
    //     return view('mypage.owner.goods_delete', compact('goods'));
    // }

    // public function action_goods_delete(Request $request)
    // {
    //     $id = $request->goods_ids;
    //     $goods_folder_id = $request->goods_folder_ids;

    //     //idをもとにgoods.tableから削除
    //     $goods = Goods::where('id', $id)->delete();

    //     $return_view = $this->goods_edit($goods_folder_id);
    //     return $return_view;

    // }

    // public function action_goods_delete(Request $request)
    // {
    //     //idをもとにgoodsfolders.tableから削除

    //     $id = $request->id;

    //     $goods = Goods::where('goods_folder_id', $id)->delete();

    //     $goods_folder = GoodsFolder::where('id', $id)->delete();

    //     $return_view = $this->goods();
    //     return $return_view;

    // }

    // public function image_insert(Request $request)
    // {
    //     //新規画像登録処理

    //     $table_name = $request->table_name;
    //     $table_id = $request->table_id;

    //     //storage/imagesディレクトリに画像を保存
    //     $img = $request->file('image_path');
    //     $path = $img->store('images','public');

    //     Image::create([
    //         'table_name' => $table_name,
    //         'table_id' => $table_id,
    //         'image_path' => '/storage/' . $path,
    //     ]);
    // }

    // public function image_delete(Request $request, string $id)
    // {
    //     //画像削除処理

    //     $image_path = $request->image_path;
    //     $table_id = $request->table_id;

    //     Storage::disk('public')->delete($image_path);
       
    //     Image::where('id', $id)->delete();

    // }

    // public function image_update(Request $request)
    // {
    //     //画像アップデート処理

    //     $table_id = $request->table_id;
    //     $table_name = $request->table_name;
        
    //     // imagesディレクトリに画像を保存
    //     $img = $request->file('image_path');
    //     $path = $img->store('images','public');

    //     Image::create([
    //         'table_id'=>$table_id,
    //         'image_path' => '/storage/' . $path,
    //         'table_name'=>$table_name,
    //     ]);

    //     //削除するファイルのパスを入手
    //     $delete_path = $request->delete_path;
    //     //storageから画像ファイルを削除
    //     Storage::disk('public')->delete($delete_path);
    //     Image::where('image_path', $delete_path)->delete();
    // }

    // public function event_image_edit(Request $request)
    // {

    //     //編集ページ表示
    //     $table_id = $request->table_id;
    //     $experiences_folder = ExperienceFolder::find($table_id);
    //     $categories = ExperienceCategory::all();

    //     $hotel_groups = HotelGroup::all();
    //     $hotel_select_ids = HotelGroupSelect::where('experience_folder_id', $experiences_folder->id)->get();
    //     $checked_hotels_group = array();
    //     foreach($hotel_select_ids as $hotel_select_id){
    //         $checked_hotels_group[] = $hotel_select_id->hotel_group_id;
    //     }
        
    //     $food_groups = FoodGroup::all();
    //     $food_select_ids = FoodGroupSelect::where('experience_folder_id',$experiences_folder->id)->get();
    //     $checked_foods_group = array();
    //     foreach($food_select_ids as $food_select_id){
    //         $checked_foods_group[] = $food_select_id->food_group_id;
    //     }
    //     return view('mypage.owner.event_edit', compact('experiences_folder', 'categories', 'hotel_groups', 'food_groups', 'checked_foods_group', 'checked_hotels_group'));
        
    // }


    // public function event_image_insert(string $id)
    // {
    //     $experiences_folder = ExperienceFolder::find($id);
    //     return view('mypage.owner.event_image_insert', compact('experiences_folder'));
    // }

    // public function action_event_image_insert(Request $request)
    // {
    //     $this->image_insert($request);

    //     $return_view = $this->event_image_edit($request);
    //     return $return_view;
    // }

    // public function event_image_update(string $id)
    // {
    //     $images = Image::find($id);
    //     $experiences_folder = ExperienceFolder::find($id);
    //     $categories = ExperienceCategory::all();
    //     return view('mypage.owner.event_image_update', compact('experiences_folder', 'categories', 'images'));
    // }

    // public function action_event_image_update(Request $request, string $id)
    // {
    //     $this->image_update($request);

    //     $return_view = $this->event_image_edit($request);
    //     return $return_view;
    // }

    // public function event_image_delete(string $id)
    // {
    //     $images = Image::find($id);
    //     $experiences_folder = ExperienceFolder::find($id);
    //     $categories = ExperienceCategory::all();
    //     return view('mypage.owner.event_image_delete', compact('experiences_folder', 'categories', 'images'));
    // }

    // public function action_event_image_delete(Request $request, string $id)
    // {
    //     $this->image_delete($request, $id);

    //     $return_view = $this->event_image_edit($request);
    //     return $return_view;
    // }

    // public function goods_image_edit(Request $request)
    // {
    //     $table_id = $request->table_id;
    //     $goods_folder = GoodsFolder::find($table_id);
    //     $categories = GoodsCategory::all();
    //     return view('mypage.owner.goods_edit', compact('goods_folder', 'categories'));
    // }

    // public function goods_image_insert(string $id)
    // {
    //     $goods_folder = GoodsFolder::find($id);
    //     return view('mypage.owner.goods_image_insert', compact('goods_folder'));
    // }

    // public function action_goods_image_insert(Request $request, string $id)
    // {
    //     $this->image_insert($request);

    //     $return_view = $this->goods_image_edit($request);
    //     return $return_view;
    // }

    // public function goods_image_update(string $id)
    // {
    //     $images = Image::find($id);
        
    //     return view('mypage.owner.goods_image_update', compact('images'));
    // }

    // public function action_goods_image_update(Request $request)
    // {
    //     $this->image_update($request, $id);
        
    //     $return_view = $this->goods_image_edit($request);
    //     return $return_view;
    // }

    
    // public function goods_image_delete(string $id)
    // {
    //     $images = Image::find($id);
    //     $goods_folder = GoodsFolder::find($id);
    //     $categories = GoodsCategory::all();
    //     return view('mypage.owner.goods_image_delete', compact('goods_folder', 'categories', 'images'));
    // }

    // public function action_goods_image_delete(Request $request, string $id)
    // {
    //     $this->image_delete($request, $id);

    //     $return_view = $this->goods_image_edit($request);
    //     return $return_view;
    // }



@extends('mypage.layouts.app')

@section('menu', 'owner_reserve')
@section('content')

    <h1>予約状況</h1>
        
   
        <div class="row justify-content-center">
        
            <div class="col-md-11 card mt-3"> 
            @forelse ($experiences_folders as $experiences_folder)
                        <div class="card mt-3">
                            <div class="card-header d-flex">
                                
                                @if($experiences_folder->is_lodging == 0)
                                <p class="text-success">宿泊なし</p>
                                @else
                                <p class="text-primary">宿泊あり</p>
                                @endif
                                
                                <p class="ms-3">{{ $experiences_folder->name }}への予約</p>
                            </div>
                            <div>  
                            <table class="table table-hover">
                                @forelse ($experiences_folder->reserves as $reserved_experience)
                                    @if ($loop->first)
                                    <thead>
                                        <tr>
                                            <th scope="col">ユーザー名</th>
                                            <th scope="col">予約日</th>
                                            <th scope="col">人数</th>
                                            <th scope="col">宿泊</th>
                                            <th scope="col">食事</th>
                                            <th scope="col">連絡事項</th>
                                            <th scope="col">ステータス</th>
                                            <th scope="col">選定ホテル</th>
                                        </tr>
                                    </thead>
                                    @endif
                                    <tr class="align-items-center">
                                        <th scope="row">
                                        
                                            {{ $reserved_experience->user->name }}様</th>
                                      
                                        <td>
                                            {{ $reserved_experience->experience->start_date }}
                                        </td>
                                        <td>
                                                大人: {{ $reserved_experience->quantity_adult }}人 子ども: {{ $reserved_experience->quantity_child }}人
                                        </td>  
                                        <td>
                                            {{ $reserved_experience->hotelGroup?->name ?? 'なし' }}
                                        </td>
                                        <td>
                                            {{ $reserved_experience->foodGroup?->name ?? 'なし' }}
                                        </td>
                                        <td>
                                            {{ $reserved_experience->message }}
                                        </td>
                                        <td>
                                            @if( $reserved_experience->status == '対応待ち')
                                            <p class="bg-danger text-white mb-0 text-center">{{ $reserved_experience->status }}</p>
                                            @else
                                            <p class="bg-primary text-white mb-0 text-center">{{ $reserved_experience->status }}</p>
                                            @endif
                                        </td>
                                        <td>  
                                            {{ $reserved_experience->hotel->name ?? '未確定'}}
                                        </td>
                                    </tr>   
                                    
                                @empty
                                    <p>予約がありません</p>
                                @endforelse
                                </table>
                            </div>
                        </div>
                        
                    @empty
                        <p>体験がありません</p>
                    @endforelse

                
            </div>
        </div>
    
    

@endsection


<a href="/goods/{{ $ordered_goods_one->goods->id }}">
                    <div class="mt-1 p-3 card">
                        <div>
                            <p>名前: {{ $ordered_goods_one->goods->name }}</p>
                            <p>個数: {{ $ordered_goods_one->quantity }}</p>
                        </div>
                    </div>
                </a>